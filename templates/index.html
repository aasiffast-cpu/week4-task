{% extends "base.html" %}
{% block title %}All Posts — Flask Blog{% endblock %}
{% block content %}
<section class="page-head">
  <h1>All Posts</h1>
  <form class="search" method="get">
    <input type="text" name="q" value="{{ q }}" placeholder="Search posts..." />
    <button class="btn" type="submit">Search</button>
  </form>
</section>

{% if posts %}
<div class="grid">
  {% for p in posts %}
  <article class="card">
    <header class="card-header">
      <h2 class="card-title"><a href="{{ url_for('view_post', post_id=p.id) }}">{{ p.title }}</a></h2>
      <p class="muted">By {{ p.author.username if p.author else 'Unknown' }} • {{ p.created_at.strftime('%Y-%m-%d %H:%M') }}</p>
    </header>
    <p class="card-body">{{ p.content[:180] }}{% if p.content|length > 180 %}…{% endif %}</p>
    <footer class="card-actions">
      <a class="btn btn-ghost" href="{{ url_for('view_post', post_id=p.id) }}">Read</a>
      {% if current_user.is_authenticated and current_user.id == p.user_id %}
        <a class="btn btn-outline" href="{{ url_for('edit_post', post_id=p.id) }}">Edit</a>
        <form method="POST" action="{{ url_for('delete_post', post_id=p.id) }}" onsubmit="return confirm('Delete this post?');">
          <button class="btn btn-danger" type="submit">Delete</button>
        </form>
      {% endif %}
    </footer>
  </article>
  {% endfor %}
</div>
{% else %}
  <div class="empty">No posts yet.</div>
{% endif %}
{% endblock %}
